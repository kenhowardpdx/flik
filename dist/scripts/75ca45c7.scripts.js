"use strict";var app=angular.module("citrusApp",["ngCookies","ngResource","ngSanitize","ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{templateUrl:"views/main.html",controller:"LogOutCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/time",{templateUrl:"views/time.html",controller:"TimeCtrl"}).otherwise({redirectTo:"/login"})}]),app.run(["$rootScope","$location","$cookieStore","UserServices",function(a,b,c,d){d.resetUser(),a.loggedUser=!1,c.get("authdata")&&d.login(),a.$on("$routeChangeStart",function(d,e){a.loggedUser||c.get("authdata")?("views/login.html"===e.templateUrl||"views/signup.html"===e.templateUrl)&&b.path("/"):"views/login.html"!==e.templateUrl&&"views/signup.html"!==e.templateUrl&&b.path("/login")})}]),window.FLIK={apiBaseUrl:"https://csgprohackathonapi.azurewebsites.net/",username:function(a){return a?"c*"+a:void 0}};var app=angular.module("citrusApp");app.controller("MainCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("citrusApp").controller("AuthCtrl",["$scope",function(a){var b=a.username+":"+a.password;b.length>100&&console.log("That's Too Long!")}]),angular.module("citrusApp").controller("LoginCtrl",["$scope","UserServices",function(a,b){a.login=function(a){b.login(a.username,a.password)}}]),angular.module("citrusApp").controller("LogOutCtrl",["$scope","UserServices",function(a,b){b.logout()}]),angular.module("citrusApp").controller("SignupCtrl",["$rootScope","$scope","$http","UserServices",function(a,b,c,d){var e={Username:"",Email:"",Password:"",UserID:null};b.errors=!1,b.createUser=function(){e={Password:b.password,UserName:flik.username(b.username),Name:b.name,Email:b.email,TimeZoneId:"Pacific Standard Time"},c.post(flik.apiBaseUrl+"api/users",e).success(function(c){a.user=c,d.login(b.username,b.password)}).error(function(a,c){400===c?(b.errors=!0,b.errorHeading=a.Message,b.errorList=a.Errors):(console.log("Status != 400"),console.log(c))})}}]);var app=angular.module("citrusApp");app.factory("Auth",["Base64","$cookieStore","$http",function(a,b,c){return c.defaults.headers.common.Authorization="Basic "+b.get("authdata"),{setCredentials:function(d,e){var f=a.encode(d+":"+e);c.defaults.headers.common.Authorization="Basic "+f,b.put("authdata",f)},clearCredentials:function(){document.execCommand("ClearAuthenticationCache"),b.remove("authdata"),c.defaults.headers.common.Authorization="Basic "},readCredentials:function(){var c=a.decode(b.get("authdata"));return b.get("authdata")+" ---- "+c}}}]),app.factory("UserServices",["Auth","$cookieStore","$rootScope","$http","$location",function(a,b,c,d,e){return{login:function(f,g){f&&g?(a.setCredentials(FLIK.username(f),g),this.login()):b.get("authdata")?d.get(FLIK.apiBaseUrl+"api/users").success(function(a){c.user=a,c.loggedUser=!0;var b=e.path();("/login"===b||"/signup"===b)&&e.path("/")}).error(function(a){e.path("/login"),console.log(a)}):e.path("/login")},logout:function(){a.clearCredentials(),this.resetUser(),e.path("/login")},resetUser:function(){c.user={Email:"",ExternalSystemKey:null,Name:"",TimeZoneId:"",UseStopwatchApproachToTimeEntry:!1,UserId:0,UserName:""}}}}]),app.factory("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}});var updateThings=function(){$(".work-indicator").each(function(){var a=$(this),b=$(window).height();a.height(b)})};updateThings(),$(window).on("resize",updateThings);var toggleWorking=function(){$(".work-indicator").toggleClass("working")};angular.module("citrusApp").controller("TimeCtrl",["$scope",function(a){}]);